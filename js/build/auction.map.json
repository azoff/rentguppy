{"version":3,"file":"./js/build/auction.min.js","sources":["./js/auction/auction.js"],"names":["ELS","auctionName","document","getElementById","roommates","rooms","total","querySelector","remaining","adder","Auction","load","location","hash","substr","main","back","app","navigate","pathname","replace","auction","user","User","current","addUser","err","error","render","addEventListeners","body","classList","remove","addExitListener","addBidListener","addEventListener","e","preventDefault","bid","parseInt","target","childNodes","value","room","parentNode","dataset","id","isNaN","placeBid","renderBid","window","removeUser","users","forEach","renderUser","renderRoom","renderAuctionCopy","sumTopBids","model","rent","innerText","name","utils","formatDollars","renderModel","bids","parent","template","existing","outerHTML","templates","appendChild","renderNode","register"],"mappings":";AAAA,GAAIA,MACHC,YAAaC,SAASC,eAAe,gBACrCC,UAAWF,SAASC,eAAe,aACnCE,MAAOH,SAASC,eAAe,SAC/BG,MAAOJ,SAASK,cAAc,wBAC9BC,UAAWN,SAASK,cAAc,4BAClCE,MAAOP,SAASK,cAAc,UAG/BG,SAAQC,KAAKC,SAASC,KAAKC,OAAO,GAAIC,KAEtC,SAASC,QACRC,IAAIC,SAASN,SAASO,SAASC,QAAQ,UAAW,KAGnD,QAASL,MAAKM,SACb,IAAKA,QAAS,MAAOL,OACrB,IAAIM,MAAOC,KAAKC,SAChBH,SAAQI,QAAQH,KAAM,SAASI,KAC9B,GAAIA,IAAK,MAAOT,KAAIU,MAAMD,IAC1BE,QAAOP,QACPQ,mBAAkBP,KAAMD,QACxBnB,UAAS4B,KAAKC,UAAUC,OAAO,aAIjC,QAASH,mBAAkBP,KAAMD,SAChCY,gBAAgBX,KAAMD,QACtBa,gBAAeZ,KAAMD,SAGtB,QAASa,gBAAeZ,KAAMD,SAC7BrB,IAAIK,MAAM8B,iBAAiB,SAAU,SAASC,GAC7CA,EAAEC,gBACF,IAAIC,KAAMC,SAASH,EAAEI,OAAOC,WAAW,GAAGC,MAAO,GACjD,IAAIC,MAAOtB,QAAQsB,KAAKP,EAAEI,OAAOI,WAAWC,QAAQC,GACpD,IAAIR,IAAM,GAAKS,MAAMT,KAAM,MAAOrB,KAAIU,MAAM,0CAC5CgB,MAAKK,SAAS1B,KAAMgB,IAAK,SAASZ,IAAKY,KACtC,GAAIZ,IAAK,MAAOT,KAAIU,MAAMD,IAC1BuB,WAAUX,SAKb,QAASL,iBAAgBX,KAAMD,SAC9B6B,OAAOf,iBAAiB,eAAgB,WACvCd,QAAQ8B,WAAW7B,KAAM,SAASI,KACjC,GAAIA,IAAK,MAAOT,KAAIU,MAAMD,SAK7B,QAASE,QAAOP,SACfA,QAAQ+B,QAAQC,QAAQC,WACxBjC,SAAQhB,QAAQgD,QAAQE,WACxBC,mBAAkBnC,SAGnB,QAASoC,cACR,GAAInD,OAAQ,CAMZ,OAAOA,OAGR,QAASkD,mBAAkBnC,SAC1B,GAAIf,OAAQe,QAAQqC,MAAMC,IAC1B3D,KAAIC,YAAY2D,UAAYvC,QAAQqC,MAAMG,IAC1C7D,KAAIM,MAAMsD,UAAYE,MAAMC,cAAczD,MAC1CN,KAAIQ,UAAUoD,UAAYE,MAAMC,cAAczD,MAAMmD,cAGrD,QAASH,YAAWhC,MACnB0C,YAAY,OAAQ1C,KAAMtB,IAAII,WAG/B,QAASmD,YAAWZ,MACnBqB,YAAY,OAAQrB,KAAM3C,IAAIK,MAC9BsC,MAAKsB,OAAOZ,QAAQJ,WAGrB,QAASA,WAAUX,KAClB,GAAI4B,QAASlE,IAAIK,MAAME,cAAc,aAAe+B,IAAIK,KAAKe,MAAMZ,GAAK,WACxEkB,aAAY,MAAO1B,IAAK4B,QAGzB,QAASF,aAAYG,SAAUT,MAAOQ,QAErC,GAAIE,UAAWF,OAAO3D,cAAc,aAAemD,MAAMA,MAAMZ,GAAK,KACpE,IAAIsB,SAAUA,SAASC,UAAYC,UAAU1C,OAAOuC,SAAUT,WACzDQ,QAAOK,YAAYD,UAAUE,WAAWL,SAAUT,QAGxDY,UAAUG,SAAS,OAClB,6CACA,4GACA,4DACA,QAGDH,WAAUG,SAAS,OAClB,6CACA,mDACA,gCACA,yBACA,SACA,oFACA,sCACA,UACA,QAGDH,WAAUG,SAAS,MAClB,4CACA,sHACA,gDACA","sourcesContent":["var ELS = {\n\tauctionName: document.getElementById('auction-name'),\n\troommates: document.getElementById('roommates'),\n\trooms: document.getElementById('rooms'),\n\ttotal: document.querySelector('.rent.total .dollars'),\n\tremaining: document.querySelector('.rent.remaining .dollars'),\n\tadder: document.querySelector('.adder')\n};\n\nAuction.load(location.hash.substr(1), main);\n\nfunction back() {\n\tapp.navigate(location.pathname.replace('auction', ''));\n}\n\nfunction main(auction) {\n\tif (!auction) return back();\n\tvar user = User.current();\n\tauction.addUser(user, function(err){\n\t\tif (err) return app.error(err);\n\t\trender(auction);\n\t\taddEventListeners(user, auction);\n\t\tdocument.body.classList.remove('loading');\n\t});\n}\n\nfunction addEventListeners(user, auction) {\n\taddExitListener(user, auction);\n\taddBidListener(user, auction);\n}\n\nfunction addBidListener(user, auction) {\n\tELS.rooms.addEventListener(\"submit\", function(e){\n\t\te.preventDefault();\n\t\tvar bid = parseInt(e.target.childNodes[0].value, 10);\n\t\tvar room = auction.room(e.target.parentNode.dataset.id);\n\t\tif (bid < 1 || isNaN(bid)) return app.error(\"bids must be greater than zero dollars!\");\n\t\troom.placeBid(user, bid, function(err, bid){\n\t\t\tif (err) return app.error(err);\n\t\t\trenderBid(bid)\n\t\t});\n\t});\n}\n\nfunction addExitListener(user, auction) {\n\twindow.addEventListener('beforeunload', function(){\n\t\tauction.removeUser(user, function(err){\n\t\t\tif (err) return app.error(err);\n\t\t});\n\t});\n}\n\nfunction render(auction) {\n\tauction.users().forEach(renderUser);\n\tauction.rooms().forEach(renderRoom);\n\trenderAuctionCopy(auction);\n}\n\nfunction sumTopBids() {\n\tvar total = 0;\n\t//TODO: make this work\n\t//var nodes = document.querySelectorAll(\".bid:first-child .value\");\n\t//Array.prototype.slice.call(nodes).forEach(function(node){\n\t//\ttotal += parseInt(node.innerText, 10);\n\t//});\n\treturn total;\n}\n\nfunction renderAuctionCopy(auction) {\n\tvar total = auction.model.rent;\n\tELS.auctionName.innerText = auction.model.name;\n\tELS.total.innerText = utils.formatDollars(total);\n\tELS.remaining.innerText = utils.formatDollars(total-sumTopBids());\n}\n\nfunction renderUser(user) {\n\trenderModel('user', user, ELS.roommates);\n}\n\nfunction renderRoom(room) {\n\trenderModel('room', room, ELS.rooms);\n\troom.bids().forEach(renderBid);\n}\n\nfunction renderBid(bid) {\n\tvar parent = ELS.rooms.querySelector('[data-id=\"' + bid.room.model.id + '\"] .bids');\n\trenderModel('bid', bid, parent);\n}\n\nfunction renderModel(template, model, parent) {\n\t//TODO: cache these?\n\tvar existing = parent.querySelector('[data-id=\"' + model.model.id + '\"]');\n\tif (existing) existing.outerHTML = templates.render(template, model);\n\telse parent.appendChild(templates.renderNode(template, model));\n}\n\ntemplates.register('user',\n\t'<li class=\"user\" data-id=\"{{ model.id }}\">' +\n\t'<div class=\"avatar\" style=\"background-image:{{ model.avatar }};background-color:{{ model.color }}\"></div>' +\n\t'<h3 contenteditable=\"{{ current }}\">{{ model.name }}</h3>' +\n\t'</li>'\n);\n\ntemplates.register('room',\n\t'<li class=\"room\" data-id=\"{{ model.id }}\">' +\n\t'<h3 contenteditable=\"true\">{{ model.name }}</h3>' +\n\t'<a class=\"delete\">&times;</a>' +\n\t'<ul class=\"bids\"></ul>' +\n\t'<form>' +\n\t'<input class=\"bid\" type=\"number\" min=\"1\" step=\"1\" placeholder=\"Place a bid...\" />' +\n\t'<button type=\"submit\">Bid!</button>' +\n\t'</form>' +\n\t'</li>'\n);\n\ntemplates.register('bid',\n\t'<li class=\"bid\" data-id=\"{{ model.id }}\">' +\n\t'<div class=\"avatar\" style=\"background-image:{{ user.model.avatar }};background-color:{{ user.model.color }}\"></div>' +\n\t'<span class=\"value\">${{ model.value }}</span>' +\n\t'</li>'\n);"]}